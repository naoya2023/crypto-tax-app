<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>暗号通貨税金計算アプリ 2025</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>暗号通貨税金計算アプリ 2025</h1>
            <p>DeFi・ステーキング・送金対応</p>
        </header>

        <main class="main-grid">
            <!-- 左パネル: 設定 -->
            <div class="left-panel">
                <div class="card">
                    <div class="card__header">
                        <h3>ウォレット接続</h3>
                    </div>
                    <div class="card__body">
                        <div class="wallet-buttons">
                            <button class="btn btn--primary" id="connectMetaMask">
                                MetaMask接続
                            </button>
                            <button class="btn btn--primary" id="connectPhantom">
                                Phantom接続
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">またはアドレスを手動入力</label>
                            <input type="text" class="form-control" id="manualAddress" placeholder="0x... または ウォレットアドレス">
                        </div>

                        <div class="wallet-status" id="walletStatus"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card__header">
                        <h3>API設定</h3>
                    </div>
                    <div class="card__body">
                        <div class="form-group">
                            <label class="form-label">Etherscan API キー</label>
                            <input type="text" class="form-control" id="etherscanKey" placeholder="オプション: より高いレート制限">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">対象税年</label>
                            <select class="form-control" id="taxYear">
                                <!-- 動的に生成 -->
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card__header">
                        <h3>取引設定</h3>
                    </div>
                    <div class="card__body">
                        <button class="btn btn--primary btn--full-width" id="fetchTransactions">
                            取引履歴を取得
                        </button>
                        
                        <div class="form-group">
                            <label class="form-label">取引種別フィルター</label>
                            <select class="form-control" id="transactionFilter">
                                <option value="all">すべて</option>
                                <option value="buy">買い</option>
                                <option value="sell">売り</option>
                                <option value="transfer-in">送金受取</option>
                                <option value="transfer-out">送金送付</option>
                                <option value="defi">DeFi</option>
                                <option value="staking">ステーキング</option>
                                <option value="airdrop">エアドロップ</option>
                                <option value="swap">スワップ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card__header">
                        <h3>税金計算設定</h3>
                    </div>
                    <div class="card__body">
                        <div class="form-group">
                            <label class="form-label">計算方法</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="taxMethod" value="moving-average" checked>
                                    移動平均法
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="taxMethod" value="fifo">
                                    FIFO法
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeDeFi" checked>
                                DeFi利益を含める
                            </label>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeStaking" checked>
                                ステーキング報酬を含める
                            </label>
                        </div>

                        <button class="btn btn--primary btn--full-width" id="calculateTax">
                            税金を計算
                        </button>
                    </div>
                </div>
            </div>

            <!-- 右パネル: 結果 -->
            <div class="right-panel">
                <div class="card summary-card" id="summaryCard">
                    <div class="card__header">
                        <h3>税金計算結果</h3>
                    </div>
                    <div class="card__body">
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-label">総利益</div>
                                <div class="summary-value" id="totalProfit">¥0</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">総損失</div>
                                <div class="summary-value" id="totalLoss">¥0</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">手数料</div>
                                <div class="summary-value" id="totalFees">¥0</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">純利益</div>
                                <div class="summary-value profit" id="netProfit">¥0</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">課税対象所得</div>
                                <div class="summary-value" id="taxableIncome">¥0</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">推定税額</div>
                                <div class="summary-value tax" id="estimatedTax">¥0</div>
                            </div>
                        </div>
                        
                        <div class="tax-note">
                            <p>※ 2025年分離課税20.315%は国会審議中</p>
                        </div>

                        <div class="export-buttons">
                            <button class="btn btn--secondary" id="exportCSV">結果をエクスポート</button>
                            <button class="btn btn--outline" id="printResults">印刷</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card__header">
                        <h3>取引履歴 <span id="transactionCount">(0件)</span></h3>
                    </div>
                    <div class="card__body">
                        <div class="transaction-list" id="transactionList">
                            <div class="empty-state">
                                取引履歴を取得してください
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- ローダーオーバーレイ -->
        <div class="loader-overlay" id="loaderOverlay">
            <div class="loader">
                <div class="spinner"></div>
                <p>取引履歴を取得中...</p>
            </div>
        </div>

        <!-- アラート -->
        <div class="alert-container" id="alertContainer"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
